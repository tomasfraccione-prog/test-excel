<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn贸stico de Madurez Tecnol贸gica 2026</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #1e7e34; --secondary: #007bff; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: #333; padding: 20px; }
        .quiz-container { max-width: 650px; margin: auto; background: #fff; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        /* Barra de Progreso */
        .progress-container { width: 100%; background: #e0e0e0; height: 8px; border-radius: 10px; margin-bottom: 30px; }
        .progress-bar { height: 100%; background: var(--primary); width: 0%; border-radius: 10px; transition: 0.5s; }
        
        h2 { color: var(--primary); text-align: center; margin-top: 0; }
        .question, .lead-form, .results { display: none; }
        .active { display: block; animation: fadeIn 0.5s; }
        
        .options { list-style: none; padding: 0; margin: 25px 0; }
        button.option-btn { width: 100%; text-align: left; padding: 18px; border: 2px solid #eee; border-radius: 10px; background: white; cursor: pointer; transition: 0.2s; font-size: 16px; margin-bottom: 10px; }
        button.option-btn:hover { border-color: var(--primary); background: #f0fff4; }
        
        /* Formulario de Captura */
        input { width: 94%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .submit-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 18px; }
        
        .result-box { padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 5px solid; }
        .peligro { border-color: #dc3545; background: #fff5f5; color: #721c24; }
        .moderado { border-color: #ffc107; background: #fffdeb; color: #856404; }
        .estable { border-color: #28a745; background: #f4fff6; color: #155724; }

        .pdf-btn { background: #555; margin-top: 10px; }
        .cta-btn { display: block; text-align: center; margin-top: 20px; padding: 15px; background: var(--secondary); color: white; text-decoration: none; border-radius: 8px; font-weight: bold; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="quiz-container">
    <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>

    <div id="quiz-steps">
        <div id="questions-container"></div>

        <div id="lead-form" class="lead-form">
            <h2>隆Casi listo!</h2>
            <p>Ingres谩 tus datos para procesar el <b>Informe de Riesgo Operativo</b> personalizado.</p>
            <input type="text" id="userName" placeholder="Nombre completo" required>
            <input type="email" id="userEmail" placeholder="Email corporativo" required>
            <input type="text" id="userCompany" placeholder="Empresa" required>
            <button class="submit-btn" onclick="processResults()">Obtener mi Diagn贸stico</button>
        </div>

        <div id="results" class="results">
            <h2 id="res-title">Resultado del Diagn贸stico</h2>
            <div id="res-box" class="result-box"></div>
            <p id="res-desc"></p>
            <button class="submit-btn pdf-btn" onclick="generatePDF()"> Descargar Informe Completo (PDF)</button>
            <a id="wa-link" href="#" class="cta-btn">Agendar Consultor铆a para optimizar mi Excel</a>
        </div>
    </div>
</div>

<script>
    const questions = [
        { q: "驴Tu equipo maneja archivos con nombres como 'Ventas_Final_v2' o 'Copia_REVISADO'?", risk: "Fragmentaci贸n de informaci贸n y p茅rdida de versiones." },
        { q: "驴Alguna vez alguien borr贸 una f贸rmula o un dato por error y se dieron cuenta tarde?", risk: "Vulnerabilidad en la integridad de datos cr铆ticos." },
        { q: "驴El archivo se vuelve lento, se 'traba' o se cierra cuando tiene mucha informaci贸n?", risk: "Saturaci贸n del motor de procesamiento (Techo de Excel)." },
        { q: "驴Sab茅s exactamente qui茅n modific贸 un dato sensible ayer a las 15hs?", risk: "Falta total de auditor铆a y seguridad de la informaci贸n." },
        { q: "驴Copi谩s y peg谩s datos de una planilla a otra para armar reportes semanales?", risk: "Alto costo en horas-hombre y error humano por tareas manuales." }
    ];

    let currentStep = 0;
    let score = 0;
    let userRisks = [];

    // Cargar preguntas al inicio
    const qCont = document.getElementById('questions-container');
    questions.forEach((item, i) => {
        const div = document.createElement('div');
        div.className = `question ${i === 0 ? 'active' : ''}`;
        div.id = `q-${i}`;
        div.innerHTML = `
            <strong>${i + 1}. ${item.q}</strong>
            <ul class="options">
                <li><button class="option-btn" onclick="answer(${i}, true)">S铆, sucede</button></li>
                <li><button class="option-btn" onclick="answer(${i}, false)">No / No estoy seguro</button></li>
            </ul>
        `;
        qCont.appendChild(div);
    });

    function updateProgress() {
        const percent = ((currentStep) / (questions.length + 1)) * 100;
        document.getElementById('progressBar').style.width = percent + "%";
    }

    function answer(index, isRisk) {
        if(isRisk) {
            score++;
            userRisks.push(questions[index].risk);
        }
        document.getElementById(`q-${index}`).classList.remove('active');
        currentStep++;
        updateProgress();
        
        if(currentStep < questions.length) {
            document.getElementById(`q-${currentStep}`).classList.add('active');
        } else {
            document.getElementById('lead-form').classList.add('active');
        }
    }

    function processResults() {
        const name = document.getElementById('userName').value;
        if(!name) return alert("Por favor, complet谩 tus datos.");
        
        document.getElementById('lead-form').classList.remove('active');
        document.getElementById('results').classList.add('active');
        currentStep++;
        updateProgress();

        const resBox = document.getElementById('res-box');
        const resDesc = document.getElementById('res-desc');
        let category = "";
        let msg = "";

        if(score >= 4) {
            category = "PELIGRO INMINENTE";
            resBox.className = "result-box peligro";
            msg = "Tu operativa depende de hilos. La p茅rdida de datos o el freno del negocio es un riesgo diario.";
        } else if(score >= 2) {
            category = "RIESGO MODERADO";
            resBox.className = "result-box moderado";
            msg = "Est谩s perdiendo eficiencia y dinero en tareas manuales que ya superaron la capacidad del Excel.";
        } else {
            category = "OPERACIN ESTABLE";
            resBox.className = "result-box estable";
            msg = "Tu sistema funciona, pero hay un alto margen para optimizar procesos y escalar.";
        }

        resBox.innerHTML = `<strong>Nivel de Riesgo: ${category}</strong><br>Puntaje: ${score}/5`;
        resDesc.innerText = msg;

        // Link de WhatsApp personalizado
        const waMsg = `Hola! Soy ${name} de la empresa ${document.getElementById('userCompany').value}. Hice el test de Excel y mi nivel de riesgo es ${category} (${score}/5). Me gustar铆a hablar sobre una soluci贸n a medida.`;
        document.getElementById('wa-link').href = `https://wa.me/TUNUMERO?text=${encodeURIComponent(waMsg)}`;
    }

    function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const name = document.getElementById('userName').value;
        const company = document.getElementById('userCompany').value;

        doc.setFontSize(20);
        doc.setTextColor(30, 126, 52);
        doc.text("Informe de Diagn贸stico Tecnol贸gico 2026", 20, 20);
        
        doc.setFontSize(12);
        doc.setTextColor(100);
        doc.text(`Preparado para: ${name} - ${company}`, 20, 30);
        doc.text(`Fecha: ${new Date().toLocaleDateString()}`, 20, 35);
        
        doc.setTextColor(0);
        doc.setFontSize(14);
        doc.text("An谩lisis de Situaci贸n:", 20, 50);
        
        doc.setFontSize(11);
        let y = 60;
        if(userRisks.length > 0) {
            doc.text("Se detectaron las siguientes vulnerabilidades cr铆ticas:", 20, y);
            y += 10;
            userRisks.forEach(risk => {
                doc.text(`- ${risk}`, 25, y);
                y += 8;
            });
        } else {
            doc.text("No se detectaron riesgos cr铆ticos inmediatos, pero se recomienda optimizaci贸n.", 20, y);
            y += 10;
        }

        y += 10;
        doc.setFontSize(14);
        doc.text("Recomendaci贸n del Equipo de Desarrollo:", 20, y);
        y += 10;
        doc.setFontSize(11);
        const advice = score >= 3 ? 
            "Es urgente migrar los procesos cr铆ticos a una arquitectura de base de datos relacional para evitar p茅rdida de informaci贸n y costos ocultos por ineficiencia." : 
            "Se recomienda una auditor铆a de procesos para identificar qu茅 tareas repetitivas pueden ser automatizadas mediante scripts o mini-apps a medida.";
        
        const splitAdvice = doc.splitTextToSize(advice, 170);
        doc.text(splitAdvice, 20, y);

        doc.save(`Diagnostico_Tecnologico_${company}.pdf`);
    }
</script>

</body>
</html>
